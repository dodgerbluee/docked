name: Run Linting (Reusable)

on:
  workflow_call:
    inputs:
      node-version:
        description: 'Node.js version'
        required: true
        type: string
      check-formatting:
        description: 'Check code formatting'
        required: false
        type: boolean
        default: false

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ inputs.node-version }}
          cache: 'npm'
          cache-dependency-path: |
            package-lock.json
            server/package-lock.json
            client/package-lock.json

      - name: Install dependencies
        run: |
          npm ci
          cd server && npm ci
          cd ../client && npm ci

      - name: Run ESLint (server)
        run: |
          cd server
          # Check if lint script exists in package.json
          if grep -q '"lint"' package.json; then
            npm run lint
          elif [ -f "node_modules/.bin/eslint" ]; then
            npx eslint . --ext .js || echo "ESLint not configured for server"
          else
            echo "No linting configured for server, skipping"
          fi

      - name: Run ESLint (client)
        run: |
          cd client
          # Check if lint script exists in package.json
          if grep -q '"lint"' package.json; then
            npm run lint
          elif [ -f "node_modules/.bin/eslint" ]; then
            npx eslint src --ext .js,.jsx || echo "ESLint not configured for client"
          else
            # Use react-scripts ESLint if available
            CI=true npm run build 2>&1 | grep -i "eslint" || echo "ESLint check completed via build"
          fi

      - name: Check formatting (Prettier)
        if: inputs.check-formatting == true
        run: |
          if [ -f "node_modules/.bin/prettier" ]; then
            npx prettier --check "**/*.{js,jsx,json,css,md}" || (echo "Formatting check failed. Run 'prettier --write' to fix." && exit 1)
          else
            echo "Prettier not installed, skipping formatting check"
          fi

